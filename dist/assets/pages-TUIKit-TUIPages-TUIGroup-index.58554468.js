import{aJ as e,aK as t,aL as o,aM as r,o as s,e as n,w as i,f as a,j as l,t as u,u as d,aN as p,Q as c,v as f,i as m,k as g,aW as I,q as v,ao as _,Z as b,F as h,l as T,aH as P,aS as y,aU as E,aX as U,g as k,_ as D,C as R,n as M,x as S,J as G,D as O,U as w}from"./index-c87fa551.js";import{_ as x}from"./_plugin-vue_export-helper.1b428a4d.js";import{e as A,o as N}from"./uni-app.es.d136296e.js";import{s as C}from"./index.befce884.js";import{I as L}from"./IComponentServer.e3f3b233.js";import{_ as K}from"./newback.d745f51c.js";class $ extends L{constructor(e){super(),this.store=C.state.timStore,this.currentStore={},this.TUICore=uni.$TUIKit,this.bindTIMEvent()}destroyed(){this.unbindTIMEvent()}updateStore(e,t){this.currentStore.groupList=e.groupList,this.currentStore.searchGroup=e.searchGroup}bindTIMEvent(){this.TUICore.on(uni.$TIM.EVENT.GROUP_LIST_UPDATED,this.handleGroupListUpdated,this),this.TUICore.on(uni.$TIM.EVENT.GROUP_ATTRIBUTES_UPDATED,this.handleGroupAttributesUpdated,this)}unbindTIMEvent(){this.TUICore.off(uni.$TIM.EVENT.GROUP_LIST_UPDATED,this.handleGroupListUpdated),this.TUICore.off(uni.$TIM.EVENT.GROUP_ATTRIBUTES_UPDATED,this.handleGroupAttributesUpdated)}handleGroupListUpdated(e){}handleGroupAttributesUpdated(e){const{groupID:t,groupAttributes:o}=e.data;console.log(t,o)}}const B=e({props:{data:{type:Object,default:()=>({})},isAuth:{type:Boolean,default:!1}},setup(e,s){uni.$TUIKit.TUIGroupServer;const n=t({groupProfile:{},input:"",isEdit:!1});o((()=>{n.groupProfile=e.data,n.input=n.groupProfile.name}));return{...r(n),updateProfile:async()=>{if(n.input&&n.input!==n.groupProfile.name){const e={groupID:n.groupProfile.groupID,name:n.input};uni.$TUIKit.updateGroupProfile(e).then((e=>{})).catch((e=>{})),n.groupProfile.name=n.input,n.input=""}n.isEdit=!n.isEdit}}}});const q=x(B,[["render",function(e,t,o,r,g,I){const v=p,_=c,b=f,h=m;return s(),n(h,{class:"name"},{default:i((()=>[a(v,null,{default:i((()=>[l("群名称")])),_:1}),e.isEdit?(s(),n(_,{key:0,class:"input",modelValue:e.input,"onUpdate:modelValue":t[0]||(t[0]=t=>e.input=t),type:"text",onBlur:e.updateProfile},null,8,["modelValue","onBlur"])):(s(),n(h,{key:1,class:"name-container"},{default:i((()=>[u("span",null,d(e.groupProfile.name),1),a(b,{src:"/assets/edit-38a5f2a5.svg",mode:"scaleToFill",onClick:t[1]||(t[1]=t=>e.isEdit=!e.isEdit),class:"edit-image"})])),_:1}))])),_:1})}],["__scopeId","data-v-d57f005f"]]);const j=x(e({props:{data:{type:Object,default:()=>({})},isAuth:{type:Boolean,default:!1}},setup(e,s){const n=t({groupProfile:{},input:"",isEdit:!1});o((()=>{n.groupProfile=e.data,n.input=n.groupProfile.notification}));return{...r(n),updateProfile:async()=>{n.input&&n.input!==n.groupProfile.notification&&(s.emit("update",{key:"notification",value:n.input}),n.groupProfile.notification=n.input,n.input=""),n.isEdit=!n.isEdit}}}}),[["render",function(e,t,o,r,a,u){const p=_,c=b;return s(),g("main",{class:"notification"},[e.isEdit?(s(),n(p,{key:0,modelValue:e.input,"onUpdate:modelValue":t[0]||(t[0]=t=>e.input=t),onKeyup:I(e.updateProfile,["enter"])},null,8,["modelValue","onKeyup"])):(s(),g("section",{key:1},[e.groupProfile.notification?(s(),g("article",{key:1},d(e.groupProfile.notification),1)):(s(),g("p",{key:0},"暂无公告"))])),e.isAuth?(s(),g("footer",{key:2},[e.isEdit?(s(),n(c,{key:0,class:"btn",onClick:e.updateProfile},{default:i((()=>[l("发布")])),_:1},8,["onClick"])):(s(),n(c,{key:1,class:"btn",onClick:t[1]||(t[1]=t=>e.isEdit=!e.isEdit)},{default:i((()=>[l("编辑")])),_:1}))])):v("",!0)])}],["__scopeId","data-v-f374e9dd"]]),V=e({components:{},props:{list:{type:Array,default:()=>[]},total:{type:Number,default:()=>0},isShowDel:{type:Boolean,default:()=>!1},self:{type:Object,default:()=>({})}},setup(e,s){const n=uni.$TIM.TYPES,i=t({total:0,list:[],isShowDel:!1,self:{}});o((()=>{i.total=e.total,i.isShowDel=e.isShowDel,i.list=e.list,i.self=e.self}));return{...r(i),getMore:()=>{s.emit("more")},submit:e=>{s.emit("del",[e])},handleRoleName:e=>{let t="";switch(null==e?void 0:e.role){case n.GRP_MBR_ROLE_ADMIN:t="管理员";break;case n.GRP_MBR_ROLE_OWNER:t="群主"}return e.userID===i.self.userID&&(t+="我"),t}}}});const W=e({components:{ManageName:q,ManageNotification:j,ManageMember:x(V,[["render",function(e,t,o,r,n,i){return s(),g("main",{class:"member"},[u("ul",{class:"list",style:{"padding-left":"0"}},[(s(!0),g(h,null,T(e.list,((t,o)=>(s(),g("li",{class:"list-item",key:o},[u("aside",null,[u("img",{class:"avatar",src:(null==t?void 0:t.avatar)||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",onerror:"this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,8,["src"]),u("span",{class:"name"},d((null==t?void 0:t.nick)||(null==t?void 0:t.userID)),1),u("span",null,d(e.handleRoleName(t)),1)]),"Owner"!==t.role&&e.isShowDel?(s(),g("i",{key:0,class:"icon icon-del",onClick:o=>e.submit(t)},null,8,["onClick"])):v("",!0)])))),128)),e.list.length<e.total?(s(),g("li",{key:0,class:"list-item",onClick:t[0]||(t[0]=(...t)=>e.getMore&&e.getMore(...t))}," 查看更多 ")):v("",!0)])])}],["__scopeId","data-v-b81932e4"]])},props:{userInfo:{type:Object,default:()=>({isGroup:!1,list:[]})},conversation:{type:Object,default:()=>({})}},setup(e,s){const n=uni.$TIM.TYPES,i=uni.$TUIKit.TUIGroupServer,a=t({config:{userID:"",SDKAppID:1400813717,secretKey:"c74d2910cc6c7180b015d75d44e73ba0af399d5f3e3d159c6d09bd5903ff01a0"},conversation:{},userInfo:{isGroup:!1,list:[]},isShowMuteTimeInput:!1,editLableName:"",currentTab:"",transferType:"",isSearch:!0,isRadio:!1,transferList:[],selectedList:[],isMuteTime:!1,show:!1,typeName:{[n.GRP_WORK]:"好友工作群",[n.GRP_PUBLIC]:"陌生人社交群",[n.GRP_MEETING]:"临时会议群",[n.GRP_AVCHATROOM]:"直播群",[n.JOIN_OPTIONS_FREE_ACCESS]:"自由加入",[n.JOIN_OPTIONS_NEED_PERMISSION]:"需要验证",[n.JOIN_OPTIONS_DISABLE_APPLY]:"禁止加群"},delDialogShow:!1,userList:[],transferTitle:"",member:{admin:[],member:[],muteMember:[]}}),l=P();o((()=>{a.conversation=e.conversation,a.userInfo=e.userInfo})),U.useStore();const u=y((()=>{let e="";switch(a.currentTab){case"notification":e="群公告";break;case"member":e="群成员";break;default:e="群管理"}return e}));E((()=>a.userInfo.list),((e,t)=>{a.member={admin:[],member:[],muteMember:[]},e.map((e=>{switch(null==e?void 0:e.role){case n.GRP_MBR_ROLE_ADMIN:a.member.admin.push(e);break;case n.GRP_MBR_ROLE_MEMBER:a.member.member.push(e)}return e}));const o=(new Date).getTime();a.member.muteMember=e.filter((e=>1e3*(null==e?void 0:e.muteUntil)-o>0))}),{deep:!0});const d=y((()=>{var e,t;const{conversation:o}=a,r=null==(e=null==o?void 0:o.groupProfile)?void 0:e.selfInfo.role,s=null==(t=null==o?void 0:o.groupProfile)?void 0:t.type,i=r===n.GRP_MBR_ROLE_OWNER,l=s===n.GRP_WORK;return i&&!l})),p=y((()=>{var e;const{conversation:t}=a;return!((null==(e=null==t?void 0:t.groupProfile)?void 0:e.type)!==n.GRP_WORK)})),c=y((()=>{let e=3;return p.value||(e+=1),"Owner"!==a.conversation.groupProfile.selfInfo.role&&(e+=1),e})),f=y((()=>{var e;const{conversation:t}=a,o=null==(e=null==t?void 0:t.groupProfile)?void 0:e.selfInfo.role,r=o===n.GRP_MBR_ROLE_OWNER,s=o===n.GRP_MBR_ROLE_ADMIN;return r||s})),m=y((()=>{var e,t;const{conversation:o}=a,r=null==(e=null==o?void 0:o.groupProfile)?void 0:e.type,s=(null==(t=null==o?void 0:o.groupProfile)?void 0:t.selfInfo.role)===n.GRP_MBR_ROLE_OWNER,i=r===n.GRP_WORK,l=r===n.GRP_AVCHATROOM;return!(i||l||!s)})),g=e=>{var t;const{conversation:o}=a,r={groupID:null==(t=null==o?void 0:o.groupProfile)?void 0:t.groupID,count:100,offset:e&&"more"===e?a.userInfo.list.length:0};uni.$TUIKit.getGroupMemberList(r).then((t=>{a.userInfo.list=e&&"more"===e?[...a.userInfo.list,...t.data.memberList]:t.data.memberList}))},I=e=>{a.currentTab=e,a.editLableName="","member"===a.currentTab&&(a.transferType="remove"),a.currentTab||(a.transferType="")},v=(e,t)=>{const o=[];e.map((e=>(o.push(e.userID),e)))};g(),A((e=>!("backbutton"!==e.from||!a.currentTab)&&(I(""),!0)));return{...r(a),isDismissGroupAuth:d,isShowAddMember:p,isAdmin:m,isAuth:f,quit:async e=>{await uni.$TUIKit.quitGroup(e.groupID),a.config.userID=String(k("user_Id"));const t=D(a.config).userSig;uni.$TUIKit.logout({userID:String(k("user_Id")),userSig:t}).then((e=>{uni.$TUIKit.login({userID:String(k("user_Id")),userSig:t}).then((e=>{R({url:"../../TUIPages/TUIConversation/index"})}))}))},dismiss:async e=>{console.log(33333,e),await uni.$TUIKit.dismissGroup(e.groupID),a.config.userID=String(k("user_Id"));const t=D(a.config).userSig;uni.$TUIKit.logout({userID:String(k("user_Id")),userSig:t}).then((e=>{uni.$TUIKit.login({userID:String(k("user_Id")),userSig:t}).then((e=>{R({url:"../../TUIPages/TUIConversation/index"})}))}))},edit:e=>{a.editLableName=e},updateProfile:async e=>{const{key:t,value:o}=e,r={groupID:a.conversation.groupProfile.groupID,[t]:o},s=await uni.$TUIKit.updateGroupProfile(r),{conversation:n}=i.store;n.groupProfile=s.data.group,i.store.conversation={},i.store.conversation=n,a.editLableName=""},setTab:I,TabName:u,getMember:g,submit:e=>{"remove"===a.transferType?(a.userList=e,a.delDialogShow=!a.delDialogShow):v(e,a.transferType)},handleManage:v,showUserNum:c,dialog:l,handleOperateMember:e=>{e&&M({url:`../TUIGroup/memberOperate?type=${e}&groupID=${a.conversation.groupProfile.groupID}`})}}}});const F=x(e({name:"TUIConversation",components:{TUIGroupManage:x(W,[["render",function(e,t,o,r,c,I){const _=f,b=m,P=O,y=S("ManageMember"),E=S("ManageNotification"),U=p;return s(),n(b,{class:"manage",ref:"dialog"},{default:i((()=>{var o;return[e.currentTab?"member"===e.currentTab?(s(),n(y,{key:1,self:e.conversation.groupProfile.selfInfo,list:e.userInfo.list,total:null==(o=e.conversation.groupProfile.memberCount)?void 0:o.memberCount,isShowDel:"Owner"===e.conversation.groupProfile.selfInfo.role,onMore:t[4]||(t[4]=t=>e.getMember("more")),onDel:e.submit},null,8,["self","list","total","isShowDel","onDel"])):"notification"===e.currentTab?(s(),n(E,{key:2,isAuth:e.isAuth,data:e.conversation.groupProfile,onUpdate:e.updateProfile},null,8,["isAuth","data","onUpdate"])):"admin"===e.currentTab?(s(),g("main",{key:3,class:"admin"},[e.isAdmin?(s(),n(b,{key:0,class:"admin-list"},{default:i((()=>[a(U,null,{default:i((()=>[l("群管理员")])),_:1}),a(b,null,{default:i((()=>[(s(!0),g(h,null,T(e.member.admin,((e,t)=>(s(),n(b,{key:t},{default:i((()=>[a(b,null,{default:i((()=>[u("img",{class:"avatar",src:(null==e?void 0:e.avatar)||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",onerror:"this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,8,["src"])])),_:2},1024),a(b,null,{default:i((()=>[l(d((null==e?void 0:e.nick)||(null==e?void 0:e.userID)),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})):v("",!0)])):v("",!0):(s(),n(b,{key:0,class:"main"},{default:i((()=>[a(b,{class:"quntitle"},{default:i((()=>{var t,o;return[a(_,{style:{margin:"0 24rpx",width:"100rpx",height:"100rpx","border-radius":"50%"},src:(null==(o=null==(t=e.conversation)?void 0:t.groupProfile)?void 0:o.avatar)||"https://sdk-web-1252463788.cos.ap-hongkong.myqcloud.com/im/demo/TUIkit/web/img/constomer.svg",onerror:"this.src='https://sdk-web-1252463788.cos.ap-hongkong.myqcloud.com/im/demo/TUIkit/web/img/constomer.svg'"},null,8,["src"]),a(b,null,{default:i((()=>[a(b,{style:{color:"#333333","font-size":"30rpx","margin-bottom":"20rpx"}},{default:i((()=>[l(d(e.conversation.groupProfile.name),1)])),_:1}),a(b,{style:{color:"#9EA2AF","font-size":"26rpx"}},{default:i((()=>[l(" 群聊号码："+d(e.conversation.groupProfile.groupID),1)])),_:1})])),_:1})]})),_:1}),a(b,{class:"userInfo space-top"},{default:i((()=>[a(b,{class:"userInfo-header",style:{padding:"0 24rpx"},onClick:t[0]||(t[0]=t=>e.setTab("member"))},{default:i((()=>[a(b,null,{default:i((()=>[l(" 群成员 "),a(P,{style:{color:"#9EA2AF"}},{default:i((()=>[l(d(e.conversation.groupProfile.memberCount)+"/"+d(e.conversation.groupProfile.maxMemberCount),1)])),_:1})])),_:1}),a(b,{style:{display:"flex","align-items":"center"}},{default:i((()=>[l(" 查看全部 "),a(_,{class:"image-right",src:"/assets/right-arrow-6158bb73.svg"})])),_:1})])),_:1}),a(b,{style:{"border-bottom":"1rpx solid #E7E9EE","margin-bottom":"32rpx"}}),a(b,{style:{display:"flex",padding:"0 24rpx"}},{default:i((()=>{var t,o;return[(s(!0),g(h,null,T(null==(o=null==(t=e.userInfo)?void 0:t.list)?void 0:o.slice(0,e.showUserNum),((e,t)=>(s(),n(b,{key:t,style:{"margin-right":"35rpx","text-align":"center"}},{default:i((()=>[a(b,{style:{"margin-bottom":"14rpx"}},{default:i((()=>[a(_,{class:"avatar",src:(null==e?void 0:e.avatar)||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",onerror:"this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,8,["src"])])),_:2},1024),a(b,{class:"text-ellipsis"},{default:i((()=>[l(d((null==e?void 0:e.nick)||(null==e?void 0:e.userID)),1)])),_:2},1024)])),_:2},1024)))),128))]})),_:1})])),_:1}),a(b,{class:"content space-top",onClick:t[1]||(t[1]=t=>e.editLableName="")}),a(b,{style:{height:"96rpx","line-height":"96rpx",color:"#333333","font-size":"28rpx","border-bottom":"1rpx solid #E7E9EE","padding-left":"24rpx"}},{default:i((()=>[l(" 群介绍")])),_:1}),a(b,{style:{"margin-left":"24rpx",height:"132rpx",color:"#8E92A4","margin-top":"20rpx"}},{default:i((()=>[l(d(e.conversation.groupProfile.introduction||"暂无介绍"),1)])),_:1}),a(b,{class:"footer space-top"},{default:i((()=>[e.isDismissGroupAuth?(s(),n(b,{key:0,class:"group-btn",onClick:t[2]||(t[2]=G((t=>e.dismiss(e.conversation.groupProfile)),["stop"]))},{default:i((()=>[l(" 解散群聊 ")])),_:1})):(s(),n(b,{key:1,class:"group-btn",onClick:t[3]||(t[3]=G((t=>e.quit(e.conversation.groupProfile)),["stop"]))},{default:i((()=>[l(" 退出群组 ")])),_:1}))])),_:1})])),_:1}))]})),_:1},512)}],["__scopeId","data-v-b794500e"]])},setup(e){const o=C.state.timStore;uni.$TUIKit.TUIGroupServer=new $;const s=t({conversation:y((()=>o.conversation)),userInfo:{isGroup:!1,list:[]}});return N((()=>{uni.$TUIKit.TUIGroupServer.destroyed()})),{...r(s),back:()=>{w({delta:1})},data:s}}}),[["render",function(e,t,o,r,n,u){const d=f,p=m,c=S("var-app-bar"),I=S("TUIGroupManage");return s(),g(h,null,[a(c,{style:{border:"none",position:"fixed",top:"0","z-index":"2"},round:"",color:"#fff",elevation:!1},{content:i((()=>[a(p,{class:"nav"},{default:i((()=>[a(d,{onClick:e.back,style:{width:"40rpx",height:"40rpx",margin:"0 20rpx",position:"absolute",left:"0"},src:K,mode:"widthFix"},null,8,["onClick"]),a(p,{class:"navtitle"},{default:i((()=>[l("群聊信息")])),_:1})])),_:1})])),_:1}),a(I,{class:"setting",conversation:e.conversation,userInfo:e.userInfo},null,8,["conversation","userInfo"])],64)}],["__scopeId","data-v-8f0d7820"]]);export{F as default};
