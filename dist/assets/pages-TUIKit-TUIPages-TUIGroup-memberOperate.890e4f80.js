import{aJ as s,o as e,e as t,w as o,aK as r,a5 as i,aM as a,i as n,f as l,q as u,j as c,u as p,A as d,k as I,l as h,F as f,ac as m,ad as D,d as U,U as _,Q as v,v as y}from"./index-c87fa551.js";import{s as C}from"./index.befce884.js";import{b as g}from"./uni-app.es.d136296e.js";import{_ as L}from"./selected.51ceb6f0.js";import{_ as k}from"./_plugin-vue_export-helper.1b428a4d.js";const x=k(s({name:"Create",props:{},setup(s,e){uni.$TUIKit.TUIGroupServer;const{userInfo:t}=C.state.timStore,o=r({userID:(null==t?void 0:t.userID)||"",inputUserID:"",chooseUserList:[],title:"发起会话",type:"",groupID:""});g((s=>{o.title=(null==s?void 0:s.title)||"发起会话",o.type=(null==s?void 0:s.type)||"",o.groupID=(null==s?void 0:s.groupID)||"",i({title:"add"===(null==s?void 0:s.type)?"添加成员":"删除成员"});const e={groupID:o.groupID,count:100,offset:0};uni.$TUIKit.getGroupMemberList(e).then((s=>{0===s.code&&(o.chooseUserList=(s.data.memberList||[]).map((s=>({...s,isShow:!0,isExist:!0}))))}))}));return{...a(o),handleUserIdInput:s=>{o.inputUserID=s.detail.value},handleGetUserProfileInfo:()=>{if(!o.inputUserID)return;const s=[o.inputUserID];m({title:"加载中"}),uni.$TUIKit.getUserProfile({userIDList:s}).then((s=>{if(D(),s.data.length>0){const e={...s.data[0],isChoose:!1,isShow:!0};0===o.chooseUserList.filter((s=>e.userID===s.userID)).length?o.chooseUserList.push(e):o.chooseUserList=o.chooseUserList.map((s=>s.userID===e.userID?{...s,isShow:!0}:s))}else U({title:"搜索用户不存在",icon:"error"}),o.inputUserID=""})).catch((s=>{D()}))},handleChoose:s=>{if(s.isExist&&"add"===o.type)return;const e=o.chooseUserList.map((e=>s.userID==e.userID?{...e,isChoose:!e.isChoose}:e));o.chooseUserList=e},handleConfirmOperate:async()=>{const{type:s,groupID:e}=o;if("add"===s){const s=o.chooseUserList.filter((s=>s.isChoose&&!s.isExist)).map((s=>s.userID));await uni.$TUIKit.addGroupMember({groupID:e,userIDList:s}),_()}if("remove"===s){const s=o.chooseUserList.filter((s=>s.isChoose)).map((s=>s.userID));uni.$TUIKit.deleteGroupMember({groupID:e,userIDList:s}).catch((s=>{10004==s.code&&U({title:"不能删除自己",icon:"error"})})),_()}}}}}),[["render",function(s,r,i,a,m,D){const U=v,_=n,C=y;return e(),t(_,{class:"TUI-Create-conversation-container"},{default:o((()=>[l(_,{class:"tui-search-area"},{default:o((()=>["add"===s.type?(e(),t(_,{key:0,class:"tui-search-bar"},{default:o((()=>[l(U,{class:"tui-search-bar-input",value:s.inputUserID,placeholder:"请输入用户ID",onInput:s.handleUserIdInput,onConfirm:s.handleGetUserProfileInfo,onBlur:s.handleGetUserProfileInfo},null,8,["value","onInput","onConfirm","onBlur"])])),_:1})):u("",!0),l(_,{class:"tui-showID"},{default:o((()=>[c("我的 ID："+p(s.userID),1)])),_:1})])),_:1}),s.chooseUserList.length>0?(e(),t(_,{key:0,class:d(["tui-person-list-container",{delete:"remove"===s.type}])},{default:o((()=>[(e(!0),I(f,null,h(s.chooseUserList,((r,i)=>(e(),t(_,{class:d(["tui-person-to-invite",{isExist:r.isExist}]),key:i,onClick:e=>s.handleChoose(r)},{default:o((()=>[l(_,{class:"tui-person-choose-container"},{default:o((()=>[r.isChoose?(e(),t(C,{key:0,class:"tui-normal-choose",src:L})):(e(),t(_,{key:1,class:d(["tui-normal-unchoose",{isExist:r.isExist&&"add"===s.type}])},null,8,["class"]))])),_:2},1024),l(_,{class:"tui-person-profile"},{default:o((()=>[l(C,{class:"tui-person-profile-avatar",src:r.avatar||"https://sdk-web-1252463788.cos.ap-hongkong.myqcloud.com/component/TUIKit/assets/avatar_21.png"},null,8,["src"]),l(_,null,{default:o((()=>[l(_,{class:"tui-person-profile-nick"},{default:o((()=>[c(p(r.nick),1)])),_:2},1024),l(_,{class:"tui-person-profile-userID"},{default:o((()=>[c("用户ID："+p(r.userID),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),r.isExist&&"add"===s.type?(e(),t(_,{key:0,class:"exist-tips"},{default:o((()=>[c("(已在群聊中)")])),_:1})):u("",!0)])),_:2},1032,["class","onClick"])))),128))])),_:1},8,["class"])):u("",!0),l(_,{class:"tui-confirm-btn-container"},{default:o((()=>[l(_,{class:"tui-confirm-btn",onClick:s.handleConfirmOperate},{default:o((()=>[c("确认")])),_:1},8,["onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-71d9aee3"]]);export{x as default};
