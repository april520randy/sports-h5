import{a as e,ad as t,aJ as n,aK as o,aL as s,aM as a,o as i,e as r,w as l,k as c,F as u,l as d,f as I,A as p,t as v,q as g,u as m,J as T,j as C,aN as h,v as f,i as y,m as D,a6 as S,T as U,n as A,h as _,g as E,aO as M,_ as P,r as w,C as N,O as b,P as x,x as k,z as R}from"./index-c87fa551.js";import{_ as G}from"./m-tabbar.18a875e0.js";import{o as L,a as O,b as K,c as Y,r as V}from"./uni-app.es.d136296e.js";import{c as $}from"./date.8f6fd309.js";import{_ as j}from"./sckong.f3fd5d2c.js";import{_ as F}from"./_plugin-vue_export-helper.1b428a4d.js";import{s as B}from"./index.befce884.js";import{I as Q}from"./IComponentServer.e3f3b233.js";import"./pages.af45dffb.js";class H extends Q{constructor(t){super(),this.store=B.state.timStore,this.TUICore=uni.$TUIKit,e(`TIM_${uni.$chat_SDKAppID}_isTUIKit`,!0),uni.$aegis&&uni.$aegis.reportEvent({name:"platform",ext1:"platform-H5-npm",ext2:"uniTuikitExternalVue3",ext3:`${uni.$chat_SDKAppID}`}),this.bindTIMEvent(),console.log(uni.$chat_isSDKReady,"uni.$chat_isSDKReadyuni.$chat_isSDKReady"),uni.$chat_isSDKReady&&this.getConversationList()}bindTIMEvent(){this.TUICore.on(uni.$TIM.EVENT.CONVERSATION_LIST_UPDATED,this.handleConversationListUpdate)}unbindTIMEvent(){this.TUICore.off(uni.$TIM.EVENT.CONVERSATION_LIST_UPDATED,this.handleConversationListUpdate)}handleConversationListUpdate(e){B.commit("timStore/setConversationList",e.data)}destroyed(){this.unbindTIMEvent()}async getConversationList(){return new Promise((async(e,n)=>{try{const n=await uni.$TUIKit.getConversationList();console.log(n,"res.datares.datares.data"),B.commit("timStore/setConversationList",n.data.conversationList),t(),e(n)}catch(o){n(o)}}))}async getConversationProfile(e){return new Promise((async(t,n)=>{try{t(await this.TUICore.getConversationProfile(e))}catch(o){n(o)}}))}async deleteConversation(e){return new Promise((async(t,n)=>{try{t(await this.TUICore.deleteConversation(e))}catch(o){n(o)}}))}async pinConversation(e){return new Promise((async(t,n)=>{try{t(await this.TUICore.pinConversation(e))}catch(o){n(o)}}))}async muteConversation(e){return new Promise((async(t,n)=>{try{t(await this.TUICore.setMessageRemindType(e))}catch(o){n(o)}}))}async setMessageRead(e){return new Promise((async(t,n)=>{try{t(await this.TUICore.setMessageRead({conversationID:e}))}catch(o){n(o)}}))}}class W extends Q{constructor(e){super(),this.store=B.state.timStore,this.currentStore={},this.TUICore=uni.$TUIKit,this.bindTIMEvent()}destroyed(){this.unbindTIMEvent()}bindTIMEvent(){this.TUICore.on(uni.$TIM.EVENT.PROFILE_UPDATED,this.handleProfileUpdated,this)}unbindTIMEvent(){this.TUICore.off(uni.$TIM.EVENT.PROFILE_UPDATED,this.handleProfileUpdated)}handleProfileUpdated(e){}}const J=n({props:{conversationList:{type:Array,default:()=>[]},currentID:{type:String,default:()=>""}},setup(e,t){const n=o({conversationList:[],currentID:"",isOpened:"none",currentConversation:{},dialogID:""});s((()=>{n.conversationList=e.conversationList,n.currentID=e.currentID}));return{...a(n),handleGotoItem:e=>{t.emit("handleGotoItem",e)},handleItemAvator:e=>{var t,n,o;let s="";switch(e.type){case uni.$TIM.TYPES.CONV_C2C:s=(null==(t=null==e?void 0:e.userProfile)?void 0:t.avatar)||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png";break;case uni.$TIM.TYPES.CONV_GROUP:s=(null==(n=null==e?void 0:e.groupProfile)?void 0:n.avatar)||"https://web.sdk.qcloud.com/component/TUIKit/assets/group_avatar.png";break;case uni.$TIM.TYPES.CONV_SYSTEM:s=(null==(o=null==e?void 0:e.groupProfile)?void 0:o.avatar)||"https://web.sdk.qcloud.com/component/TUIKit/assets/group_avatar.png"}return s},handleItemTime:e=>e>0?$(1e3*e):"",handleItemMessage:e=>e.type===uni.$TIM.TYPES.MSG_TEXT?e.payload.text:e.messageForShow,handleItemName:e=>{var t,n;let o="";switch(e.type){case uni.$TIM.TYPES.CONV_C2C:o=(null==e?void 0:e.userProfile.nick)||(null==(t=null==e?void 0:e.userProfile)?void 0:t.userID)||"";break;case uni.$TIM.TYPES.CONV_GROUP:o=e.groupProfile.name||(null==(n=null==e?void 0:e.groupProfile)?void 0:n.groupID)||"";break;case uni.$TIM.TYPES.CONV_SYSTEM:o="系统通知"}return o},handleItemLongpress:e=>{n.currentConversation=e,n.dialogID=e.conversationID,"C2C"===e.type?n.currentuserID=e.userProfile.userID:"GROUP"===e.type&&(n.currentuserID=e.groupProfile.groupID),n.conversationType=e.type},handleConversation:e=>{switch(e){case"delete":uni.$TUIKit.TUIConversationServer.deleteConversation(n.dialogID).then((e=>{e.data})),n.dialogID="";break;case"ispinned":if("ispinned"===e){const e={conversationID:n.dialogID,isPinned:!0};uni.$TUIKit.TUIConversationServer.pinConversation(e).then((e=>{console.log(e)}))}n.dialogID="";break;case"dispinned":if("dispinned"===e){const e={conversationID:n.dialogID,isPinned:!1};uni.$TUIKit.TUIConversationServer.pinConversation(e).then((e=>{}))}n.dialogID="";break;case"mute":if("mute"===e&&"C2C"===n.conversationType){const e={userIDList:[n.currentuserID],messageRemindType:uni.$TIM.TYPES.MSG_REMIND_ACPT_NOT_NOTE};uni.$TUIKit.TUIConversationServer.muteConversation(e).then((e=>{console.log(e)}))}else if("mute"===e&&"GROUP"===n.conversationType){const e={groupID:n.currentuserID,messageRemindType:uni.$TIM.TYPES.MSG_REMIND_ACPT_NOT_NOTE};uni.$TUIKit.TUIConversationServer.muteConversation(e).then((e=>{console.log(e)}))}n.dialogID="";break;case"notMute":if("notMute"===e&&"C2C"===n.conversationType){const e={userIDList:[n.currentuserID],messageRemindType:uni.$TIM.TYPES.MSG_REMIND_ACPT_AND_NOTE};uni.$TUIKit.TUIConversationServer.muteConversation(e).then((e=>{console.log(e)}))}else if("notMute"===e&&"GROUP"===n.conversationType){const e={groupID:n.currentuserID,messageRemindType:uni.$TIM.TYPES.MSG_REMIND_ACPT_AND_NOTE};uni.$TUIKit.TUIConversationServer.muteConversation(e).then((e=>{console.log(e)}))}n.dialogID=""}},handlerIsOpened:e=>e.conversationID===n.doalogID?"right":"none"}}});const q=F(J,[["render",function(e,t,n,o,s,a){const D=h,S=f,U=y;return i(),r(U,{class:"TUI-conversation-list",onClick:t[5]||(t[5]=t=>e.dialogID="")},{default:l((()=>[(i(!0),c(u,null,d(e.conversationList,((n,o)=>(i(),r(U,{key:o},{default:l((()=>[I(U,{class:p(["TUI-conversation-item",[e.dialogID===n.conversationID&&"selected",n.isPinned&&"pinned"]]),onClick:t=>e.handleGotoItem(n),onLongpress:t=>e.handleItemLongpress(n)},{default:l((()=>[v("aside",{class:"left"},[v("img",{class:"avatar",src:e.handleItemAvator(n)},null,8,["src"]),n.unreadCount>0&&"AcceptNotNotify"===n.messageRemindType?(i(),c("span",{key:0,class:"num-notNotify"})):g("",!0)]),v("main",{class:"content"},[n.unreadCount>0&&"AcceptNotNotify"!==n.messageRemindType?(i(),c("span",{key:0,class:"num"},m(n.unreadCount>99?"99+":n.unreadCount),1)):g("",!0),v("header",{class:"content-header"},[I(D,null,{default:l((()=>[v("p",{class:"name"},m(e.handleItemName(n)),1)])),_:2},1024)]),v("footer",{class:"content-footer"},[n.unreadCount>0&&"AcceptNotNotify"===n.messageRemindType?(i(),c("span",{key:0,class:"content-footer-unread"},"["+m(n.unreadCount>99?"99+":n.unreadCount)+"条]",1)):g("",!0),v("span",{class:"message-text"},m(e.handleItemMessage(n.lastMessage)),1)]),I(U,{class:"item-footer"},{default:l((()=>[v("span",{class:"time"},m(e.handleItemTime(n.lastMessage.lastTime)),1),"AcceptNotNotify"===n.messageRemindType?(i(),r(S,{key:0,class:"mute-icon",src:"/assets/mute-21f61b43.svg"})):g("",!0)])),_:2},1024)]),n.conversationID===e.dialogID?(i(),r(U,{key:0,class:"dialog-box dialog-item"},{default:l((()=>[I(U,{class:"conversation-options",onClick:t[0]||(t[0]=T((t=>e.handleConversation("delete",e.dialogID)),["stop"]))},{default:l((()=>[C("删除会话")])),_:1}),n.isPinned?g("",!0):(i(),r(U,{key:0,class:"conversation-options",onClick:t[1]||(t[1]=T((t=>e.handleConversation("ispinned",e.dialogID)),["stop"]))},{default:l((()=>[C("置顶会话")])),_:1})),n.isPinned?(i(),r(U,{key:1,class:"conversation-options",onClick:t[2]||(t[2]=T((t=>e.handleConversation("dispinned",e.dialogID)),["stop"]))},{default:l((()=>[C("取消置顶")])),_:1})):g("",!0),""===n.messageRemindType||"AcceptAndNotify"===n.messageRemindType?(i(),r(U,{key:2,class:"conversation-options",onClick:t[3]||(t[3]=T((t=>e.handleConversation("mute",e.dialogID)),["stop"]))},{default:l((()=>[C("消息免打扰")])),_:1})):g("",!0),"AcceptNotNotify"===n.messageRemindType?(i(),r(U,{key:3,class:"conversation-options",onClick:t[4]||(t[4]=T((t=>e.handleConversation("notMute",e.dialogID)),["stop"]))},{default:l((()=>[C("取消免打扰")])),_:1})):g("",!0)])),_:2},1024)):g("",!0)])),_:2},1032,["class","onClick","onLongpress"])])),_:2},1024)))),128)),0==e.conversationList.length?(i(),r(U,{key:0,style:{display:"flex","justify-content":"center","flex-direction":"column","align-items":"center",width:"100%",height:"100%","margin-top":"550rpx"}},{default:l((()=>[I(S,{src:j,mode:"",style:{width:"400rpx",height:"400rpx"}}),I(U,{style:{color:"#9ea2af","font-size":"26rpx","margin-top":"15rpx"}},{default:l((()=>[C(" 暂无数据 ")])),_:1})])),_:1})):g("",!0)])),_:1})}],["__scopeId","data-v-c48cd45d"]]),Z=n({name:"dialog",props:{visible:{type:Boolean,default:()=>!1},styleConfig:{type:Object,default:()=>({width:"240px",padding:"16px",top:"10px",right:"10px"})},handleClose:{type:Function,default:()=>{}}},setup(e,t){}});const z=n({name:"TUIConversation",components:{TUIConversationList:q,Dialog:F(Z,[["render",function(e,t,n,o,s,a){const c=y;return e.visible?(i(),r(c,{key:0,class:"dialog",onClick:e.handleClose},{default:l((()=>[I(c,{class:"dialog-container",style:D(e.styleConfig)},{default:l((()=>[S(e.$slots,"default",{},void 0,!0)])),_:3},8,["style"])])),_:3},8,["onClick"])):g("",!0)}],["__scopeId","data-v-d2be613c"]])},setup(t){const n=M(),s=B.state.timStore;uni.$TUIKit.TUIConversationServer=new H,uni.$TUIKit.TUIProfileServer=new W;const i=o({current:3,Chat_State:0,clean:!1,tabbar:U,Anchoer_Attest_Status:"",conversationList:[],currrentConversationID:"",open:!1,searchUserID:"",selectedList:[],searchUserList:[],step:1,showDialog:!1,item:{flow:"out",status:"success"},styleConfig:{width:"150px",padding:"16px 16px 0px",top:"8px",right:"8px"},chatList:[{imgType:"SINGLE",type:uni.$TIM.TYPES.CONV_C2C,id:1,content:"发起会话"},{imgType:"GROUP",type:uni.$TIM.TYPES.GRP_WORK,id:1,content:"工作群"},{imgType:"GROUP",type:uni.$TIM.TYPES.GRP_PUBLIC,id:2,content:"社交群"},{imgType:"GROUP",type:uni.$TIM.TYPES.GRP_MEETING,id:3,content:"会议群"}],config:{userID:"",SDKAppID:1400813717,secretKey:"c74d2910cc6c7180b015d75d44e73ba0af399d5f3e3d159c6d09bd5903ff01a0"}});L((()=>{uni.$TUIKit.TUIConversationServer.destroyed()})),O((()=>{i.showDialog=!i.showDialog})),console.log(B,"store.state.userInfo.User_Idstore.state.userInfo.User_Id"),K((()=>{uni.$TUIKit.on(uni.$TIM.EVENT.SDK_NOT_READY,r)})),Y((()=>{null!=n.state.userInfo.User_Id?setTimeout((()=>{_(),console.log(i.conversationList,"data.conversationList");let e=[];s.conversationList.forEach((t=>{"@TIM#SYSTEM"==t.type||"AVChatRoom"==t.subType||e.push(t)})),console.log(e,"data.conversationList"),i.conversationList=e,B.commit("timStore/setConversationList",e),i.Anchoer_Attest_Status=n.state.userInfo.Anchoer_Attest_Status,console.log("222",i.Anchoer_Attest_Status),i.Chat_State=E("Chat_State"),console.log(E("New_State")),1==i.Chat_State&&(1==E("New_State")?i.current=3:i.current=2)}),1e3):A({url:"/pages/login/index"})}));const r=e=>{console.log(e),i.clean=!0},l=e=>{var t,n;let o="";switch(e.type){case uni.$TIM.TYPES.CONV_C2C:o=(null==e?void 0:e.userProfile.nick)||(null==(t=null==e?void 0:e.userProfile)?void 0:t.userID)||"";break;case uni.$TIM.TYPES.CONV_GROUP:o=e.groupProfile.name||(null==(n=null==e?void 0:e.groupProfile)?void 0:n.groupID)||"";break;case uni.$TIM.TYPES.CONV_SYSTEM:o="系统通知"}return o};return{...a(i),handleCurrrentConversation:e=>{i.currrentConversationID=e.conversationID,B.commit("timStore/setConversationID",e.conversationID),A({url:`../TUIChat/index?conversationName=${l(e)}`}),uni.$TUIKit.TUIConversationServer.setMessageRead(e.conversationID);const t=i.conversationList.filter((t=>t.conversationID==e.conversationID));B.commit("timStore/setConversation",t),uni.$TUIKit.TUIConversationServer.getConversationProfile(e.conversationID).then((e=>{B.commit("timStore/setConversation",e.data.conversation)}))},handleContentClick:e=>{i.showDialog=!1,A({url:`../TUIConversation/create?title=${e.content}&type=${e.type}`})},handleItemName:l,handleClose:()=>{i.showDialog=!1},handleShow:()=>{i.showDialog=!0},addgroup:()=>{A({url:"/pages/chatView/addgroup/addgroup"})},newIM:()=>{const e=P(i.config).userSig;uni.$TUIKit.login({userID:String(n.state.userInfo.User_Id),userSig:e}).then((e=>{console.log(e),i.clean=!1}))},submit:()=>{n.commit("CHANGE_USER_ID",""),n.commit("CHANGE_USER_INFO",{}),w("user_Id"),e("currentIndex",0),i.clean=!1,N({url:"/pages/myView/index",animationType:"pop-in",animationDuration:200})}}}});const X=F(z,[["render",function(e,t,n,o,s,a){const p=y,v=f,h=k("var-app-bar"),D=k("Dialog"),S=k("TUIConversationList"),U=V(R("m-tabbar"),G);return i(),r(p,null,{default:l((()=>[I(h,{style:{border:"none",position:"fixed",top:"0","z-index":"2","background-color":"#FFFFFF"},color:"#fff",round:"",elevation:!1},{content:l((()=>[I(p,{class:"nav"},{default:l((()=>[I(p,{class:"navtitle"},{default:l((()=>[C("聊天列表")])),_:1}),2==e.Anchoer_Attest_Status?(i(),r(p,{key:0,style:{display:"flex","align-items":"center",position:"absolute",right:"20rpx"},onClick:t[0]||(t[0]=t=>e.addgroup())},{default:l((()=>[I(v,{src:"data:image/png;base64,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",style:{width:"40rpx",height:"40rpx"}})])),_:1})):g("",!0)])),_:1})])),_:1}),I(p,{style:{width:"100%",height:"1px",background:"#E7E9EE"}}),I(D,{visible:e.showDialog,styleConfig:e.styleConfig,handleClose:e.handleClose},{default:l((()=>[(i(!0),c(u,null,d(e.chatList,((t,n)=>(i(),r(p,{key:n,class:"chat-container",onClick:T((n=>e.handleContentClick(t)),["stop"])},{default:l((()=>["SINGLE"===t.imgType?(i(),r(v,{key:0,class:"item-icon",src:"/assets/singlePerson-2f8834c2.svg"})):(i(),r(v,{key:1,class:"item-icon",src:"/assets/multiPerson-3b6140d6.svg"})),I(p,null,{default:l((()=>[C(m(t.content),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1},8,["visible","styleConfig","handleClose"]),I(p,{class:"TUI-conversation",style:{"margin-top":"170rpx"}},{default:l((()=>[I(S,{currentID:e.currrentConversationID,conversationList:e.conversationList,onHandleGotoItem:e.handleCurrrentConversation},null,8,["currentID","conversationList","onHandleGotoItem"])])),_:1}),b(I(U,{fixed:"",fill:"",current:e.current,tabbar:e.tabbar},null,8,["current","tabbar"]),[[x,1==e.Chat_State]])])),_:1})}],["__scopeId","data-v-6353d9be"]]);export{X as default};
